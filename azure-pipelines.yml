trigger:
- master

variables:
  - name: var1
    value: value1
  - name: var2
    value: value2

parameters:
  - name: param1
    displayName: parameter 1
    type: string
    default: dev
    values:
      - dev
      - prod

pool:
 name: DEFAULT

stages:
  - stage: Build
    displayName: Build
    jobs:
      - job: job1
        steps:
          - script: echo "This is job1, $(var1)"
      - job: job2
        steps:
          - script: echo "This is job2, ${{ parameters.param1 }}"

  - stage: Test
    displayName: Test
    dependsOn: Build
    jobs:
      - deployment: job1
        environment: dev deploy
        strategy:
          runOnce:
            deploy:
              steps:
                - script: echo "This is Test job, $(var2)"
                - task: PublishBuildArtifacts@1
                  inputs:
                    PathtoPublish: '$(Build.ArtifactStagingDirectory)'
                    ArtifactName: 'drop'
                    publishLocation: 'Container'
              
      - job:
        steps:
        - task: AzureKeyVault@2
          inputs:
            azureSubscription: 'Pay-As-You-Go(fc6e8e3f-0846-4632-9611-6e728d3eafc0)'
            KeyVaultName: 'testkeyvault676767'
            SecretsFilter: '$(keyvaulttesting)'
            RunAsPreJob: false











  # - stage: Download
  #   displayName: Download the atifacts
  #   dependsOn: Test
  #   jobs:
  #     - job:
  #       steps:
  #       - task: DownloadBuildArtifacts@1
  #         inputs:
  #           buildType: 'current'
  #           downloadType: 'single'
  #           artifactName: 'drop'
  #           downloadPath: '$(System.ArtifactsDirectory)'